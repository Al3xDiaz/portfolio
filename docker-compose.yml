version: '3.4'
services:
 gateway: 
    container_name: "gateway"
    image: "nginx:1.21.1-alpine"
    depends_on: 
        - "frontend"
        - "backend"    
    volumes: 
        - "./nginx/nginx.conf:/etc/nginx/conf.d/default.conf"
    ports: 
        - "80:80"
    restart: always
 frontend:
    container_name: "frontend"
    image: "docker.pkg.github.com/al3xdiaz/portafolio/frontend:latest"
    build:
        context: .
        dockerfile: frontend/dockerfile.test
    #restart: always
    volumes: 
        - "./frontend/src:/code/src"
        - "./frontend/public:/code/public"
 backend:
    container_name: "backend"
    image: "docker.pkg.github.com/al3xdiaz/portafolio/backend:latest"
    build: 
        context: .
        dockerfile: backend/dockerfile.test
    environment: 
            CON_STR: ${CON_STR}
            MONGO_U: ${MONGO_U}
            MONGO_P: ${MONGO_P}
    restart: always
    volumes: 
        - "./backend/main.py:/code/main.py"
    depends_on: 
        - "db"
 db:
    container_name: db
    image: mongo
    restart: always
    volumes: 
        - ./mongo/data:/data/db
    environment:
        MONGO_INITDB_ROOT_USERNAME: ${MONGO_U}
        MONGO_INITDB_ROOT_PASSWORD: ${MONGO_P}
